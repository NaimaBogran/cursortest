<%- include('partials/header', { title: 'Rate Configuration - Meeting Tax' }) %>

<div class="rates-page">
  <div class="page-header">
    <h1>Rate Configuration</h1>
    <p class="page-subtitle">Manage roles, departments, and hourly rates. Set default rates and department overrides.</p>
  </div>

  <!-- Seed preset data (if empty) -->
  <div class="rates-section" id="seed-section" style="display: none;">
    <h2>Get Started</h2>
    <p class="section-note">No roles or departments yet. Seed the database with preset roles (Engineer, PM, Designer, etc.) and departments (Engineering, Product, Design, Marketing, Sales) plus default hourly rates.</p>
    <button class="btn btn-primary" id="seed-btn">Seed Preset Data</button>
  </div>

  <!-- Roles -->
  <div class="rates-section">
    <h2>Roles</h2>
    <p class="section-note">Job roles used for meeting attendees and rate configuration.</p>
    <button class="btn btn-secondary" id="add-role-btn">+ Add Role</button>
    <div id="roles-list" class="roles-list">
      <p class="loading">Loading...</p>
    </div>
  </div>

  <!-- Departments -->
  <div class="rates-section">
    <h2>Departments</h2>
    <p class="section-note">Departments for organizing users and rate overrides.</p>
    <button class="btn btn-secondary" id="add-dept-btn">+ Add Department</button>
    <div id="departments-list" class="departments-list">
      <p class="loading">Loading...</p>
    </div>
  </div>

  <!-- Default Rates -->
  <div class="rates-section">
    <h2>Default Rates (Organization-wide)</h2>
    <div id="default-rates" class="rates-grid">
      <p class="loading">Loading rates...</p>
    </div>
  </div>

  <!-- Department Overrides -->
  <div class="rates-section">
    <h2>Department Overrides</h2>
    <p class="section-note">Override rates for specific departments. Leave blank to use default.</p>
    
    <button class="btn btn-secondary" id="add-override-btn">+ Add Override</button>
    
    <div id="override-rates" class="overrides-list">
      <!-- Populated by JS -->
    </div>
  </div>

  <!-- Add/Edit Role Modal -->
  <div class="modal" id="role-modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="role-modal-title">Add Role</h2>
        <button class="modal-close" id="role-modal-close">&times;</button>
      </div>
      <form id="role-form">
        <input type="hidden" id="role-id" value="">
        <div class="form-group">
          <label for="role-name">Name</label>
          <input type="text" id="role-name" required placeholder="e.g. Engineer">
        </div>
        <div class="form-group">
          <label for="role-slug">Slug (lowercase, no spaces)</label>
          <input type="text" id="role-slug" required placeholder="e.g. engineer">
        </div>
        <div class="form-group" id="role-rate-group">
          <label for="role-rate">Default hourly rate ($)</label>
          <input type="number" id="role-rate" min="0" step="0.01" placeholder="150.00">
          <span class="form-hint">Optional. Set now or later in Default Rates below.</span>
        </div>
        <div id="role-error" class="error-message" style="display: none;"></div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancel-role">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Role</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add/Edit Department Modal -->
  <div class="modal" id="dept-modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2 id="dept-modal-title">Add Department</h2>
        <button class="modal-close" id="dept-modal-close">&times;</button>
      </div>
      <form id="dept-form">
        <input type="hidden" id="dept-id" value="">
        <div class="form-group">
          <label for="dept-name">Name</label>
          <input type="text" id="dept-name" required placeholder="e.g. Engineering">
        </div>
        <div class="form-group">
          <label for="dept-slug">Slug (lowercase, no spaces)</label>
          <input type="text" id="dept-slug" required placeholder="e.g. engineering">
        </div>
        <div id="dept-error" class="error-message" style="display: none;"></div>
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancel-dept">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Department</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Override Modal -->
  <div class="modal" id="override-modal" style="display: none;">
    <div class="modal-content modal-small">
      <div class="modal-header">
        <h2>Add Rate Override</h2>
        <button class="modal-close" id="override-modal-close">&times;</button>
      </div>
      
      <form id="override-form">
        <div class="form-group">
          <label for="override-role">Role</label>
          <select id="override-role" required>
            <option value="">Select a role</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="override-dept">Department</label>
          <select id="override-dept" required>
            <option value="">Select a department</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="override-rate">Hourly Rate ($)</label>
          <input type="number" id="override-rate" required min="0" step="0.01" placeholder="150.00">
        </div>
        
        <div id="override-error" class="error-message" style="display: none;"></div>
        
        <div class="modal-actions">
          <button type="button" class="btn btn-secondary" id="cancel-override">Cancel</button>
          <button type="submit" class="btn btn-primary">Save Override</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Cost Threshold Setting -->
  <div class="rates-section">
    <h2>Cost Threshold</h2>
    <p class="section-note">Meetings exceeding this cost will show a warning.</p>
    
    <div class="threshold-setting">
      <label for="cost-threshold">Threshold ($)</label>
      <input type="number" id="cost-threshold" min="0" step="100" value="2000">
      <button class="btn btn-primary" id="save-threshold">Save</button>
    </div>
  </div>
</div>

<%- include('partials/footer', { pageScript: 'rates' }) %>
